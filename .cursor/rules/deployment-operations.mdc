# Despliegue y Operaciones - CactusDashboard

## üöÄ **Despliegue en AWS**

### Arquitectura de Producci√≥n
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CloudFront    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   ALB (Nginx)    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   EC2 Instances ‚îÇ
‚îÇ   (CDN)         ‚îÇ    ‚îÇ   (Load Balancer)‚îÇ    ‚îÇ   (App Servers) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Route 53      ‚îÇ    ‚îÇ   RDS            ‚îÇ    ‚îÇ   ElastiCache   ‚îÇ
‚îÇ   (DNS)         ‚îÇ    ‚îÇ   (PostgreSQL)   ‚îÇ    ‚îÇ   (Redis)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Configuraci√≥n Actual (Producci√≥n)
- **Instancia**: i-0913b3f472d7001ef
- **IP**: 34.195.179.168
- **Tipo**: t4g.small (Free Tier hasta 31-dic-2025)
- **Auto-downgrade**: t4g.micro (01-ene-2026 00:15 UTC)
- **Regi√≥n**: us-east-1
- **Presupuesto**: $75 USD/mes

## üîß **Comandos de Despliegue**

### Validaci√≥n
```bash
# Validar configuraci√≥n
task validate:aws

# Validar Terraform
cd terraform && terraform validate
```

### Despliegue
```bash
# Desplegar completo
task deploy:aws

# Solo planificar cambios
cd terraform && terraform plan
```

### Monitoreo
```bash
# Estado de la instancia
aws ec2 describe-instances --instance-ids i-0913b3f472d7001ef

# Logs de CloudWatch
aws logs describe-log-groups --log-group-name-prefix cactus-dashboard
```

## üìä **Monitoreo y Alertas**

### CloudWatch Alarms
- **CPU Utilization**: >80% por 2 per√≠odos de 5 minutos
- **Dashboard Latency**: >2000ms response time
- **Memory Usage**: Monitoreado via CloudWatch Agent

### Budget Alerts
- **Threshold**: 95% de $75/mes ($71.25)
- **Action**: Stop EC2 instance via Lambda
- **Notification**: Email a giolivosantarelli@gmail.com

### Auto-Downgrade
- **Fecha**: 2026-01-01 00:15 UTC
- **Proceso**: EventBridge ‚Üí SSM Automation ‚Üí t4g.micro

## üîÑ **Flujo de Eventos**

### Budget Exceeded Flow
```
95% Budget ‚Üí SNS ‚Üí Lambda ‚Üí Stop EC2 ‚Üí Email Alert
```

### Auto-Downgrade Flow
```
2026-01-01 00:15 UTC ‚Üí EventBridge ‚Üí SSM ‚Üí t4g.micro
```

### Health Check Flow
```
CloudWatch ‚Üí CPU/Memory ‚Üí Alarm ‚Üí SNS ‚Üí Email
```

## üõ†Ô∏è **Troubleshooting**

### Instance Issues
```bash
# Verificar estado
aws ec2 describe-instances --instance-ids i-0913b3f472d7001ef

# Reiniciar si es necesario
aws ec2 reboot-instances --instance-ids i-0913b3f472d7001ef

# SSH para debugging
ssh -i cactus-key.pem ubuntu@34.195.179.168
```

### Application Issues
```bash
# SSH al servidor
ssh -i cactus-key.pem ubuntu@34.195.179.168

# Verificar Docker
docker-compose -f docker-compose.prod.yml ps

# Ver logs
docker-compose -f docker-compose.prod.yml logs -f

# Reiniciar servicios
docker-compose -f docker-compose.prod.yml restart
```

### Budget Issues
```bash
# Verificar presupuesto
aws budgets describe-budget --account-id 644439356858 --budget-name cactus-dashboard-monthly-budget

# Ver costos actuales
aws ce get-cost-and-usage --time-period Start=2024-01-01,End=2024-01-31 --granularity MONTHLY --metrics BlendedCost
```

## üìã **Checklist de Despliegue**

### Pre-Despliegue
- [ ] Validar configuraci√≥n con `task validate:aws`
- [ ] Verificar variables en `terraform.tfvars`
- [ ] Confirmar presupuesto disponible
- [ ] Revisar cambios en `terraform plan`

### Durante Despliegue
- [ ] Monitorear progreso de Terraform
- [ ] Verificar creaci√≥n de recursos
- [ ] Confirmar configuraci√≥n de alarmas
- [ ] Validar conectividad SSH

### Post-Despliegue
- [ ] Verificar aplicaci√≥n funcionando
- [ ] Testear endpoints cr√≠ticos
- [ ] Confirmar alertas configuradas
- [ ] Documentar cambios en logs

## üîí **Seguridad**

### Network Security
- **SSH**: Restringido a IP espec√≠fica (186.127.184.104/32)
- **Firewall**: UFW configurado
- **Security Groups**: Puertos m√≠nimos abiertos
- **IMDS**: v2 habilitado

### Data Security
- **EBS**: Encriptado
- **Backups**: Autom√°ticos diarios
- **Secrets**: Variables de entorno
- **SSL**: Configurado para producci√≥n

## üìà **Optimizaci√≥n de Costos**

### Free Tier Usage
- **t4g.small**: Free Tier hasta 31-dic-2025
- **EBS**: 30GB gp3 (dentro de l√≠mites)
- **Data Transfer**: Minimizado
- **IPv6**: Deshabilitado para reducir costos

### Auto-Optimization
- **Auto-downgrade**: t4g.micro despu√©s del trial
- **Budget alerts**: Prevenir overspending
- **Resource cleanup**: Autom√°tico
- **Cost monitoring**: CloudWatch + Budgets

## üìö **Documentaci√≥n de Referencia**

### Archivos Clave
- [terraform/main.tf](mdc:terraform/main.tf) - Infraestructura principal
- [terraform/terraform.tfvars](mdc:terraform/terraform.tfvars) - Variables
- [MONITORING-RUNBOOK.md](mdc:MONITORING-RUNBOOK.md) - Procedimientos operacionales
- [logs/deployment-success.log](mdc:logs/deployment-success.log) - Log de despliegue

### URLs de Producci√≥n
- **Frontend**: http://34.195.179.168:3000
- **Backend**: http://34.195.179.168:8000
- **API Docs**: http://34.195.179.168:8000/docs
- **Health Check**: http://34.195.179.168:8000/health
